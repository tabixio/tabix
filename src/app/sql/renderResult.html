<div ng-controller="FooterCtrl as footer">

<md-tab ng-repeat="result in tab.results" >
    <md-tab-label>
        {{::result.time}}
        <i class="mdi mdi-18px ml+" ng-class="result.pinned ? 'mdi-pin' : 'mdi-pin-off'" ng-click="result.pinned = !result.pinned; $event.stopPropagation()"></i>
        <i class="mdi mdi-close" ng-click="removeResult(tab, result, $event)"></i>
    </md-tab-label>
    <md-tab-body>
        <div ng-repeat="item in result.data">
                <md-tabs md-dynamic-height md-selected="vars.selectedIndex" md-border-bottom md-autoselect>
                    <md-tab>
                        <md-tab-label>
                        Table
                        </md-tab-label>

                        <md-tab-body>
                            <md-card class="m0">
                                <div>
                                    <div class="pull-left" ng-if="item.statistics">
                                        <md-button aria-label="menu" class="md-icon-button" ng-click="addDictionariesWord(item.createtable)" ng-if="item.createtable">
                                            <i class="mdi mdi-table-large"></i>
                                        </md-button>
                                        <md-menu md-position-mode="target">
                                            <md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)">
                                                <i class="mdi mdi-file-excel"></i>
                                            </md-button>
                                            <md-menu-content>
                                                <md-menu-item>
                                                    <md-button
                                                            ng-csv="getExportData(item.data)"
                                                            quote-strings='"'
                                                            filename="{{tab.name}}-{{result.time}}.csv"
                                                            csv-header="getExportHeaders(item.meta)"
                                                    >
                                                        {{'CSV с заголовком' | translate}}
                                                    </md-button>
                                                </md-menu-item>
                                                <md-menu-item>
                                                    <md-button
                                                            ng-csv="getExportData(item.data)"
                                                            quote-strings='"'
                                                            filename="{{tab.name}}-{{result.time}}.csv"
                                                    >
                                                        {{'CSV без заголовка' | translate}}
                                                    </md-button>
                                                </md-menu-item>
                                                <md-menu-item>
                                                    <md-button
                                                            ng-csv="getExportData(item.data)"
                                                            quote-strings=''
                                                            filename="{{tab.name}}-{{result.time}}.txt"
                                                            field-separator="\t"
                                                            csv-header="getExportHeaders(item.meta)"
                                                    >
                                                        {{'Табулированный текст с заголовками' | translate}}
                                                    </md-button>
                                                </md-menu-item>
                                                <md-menu-item>
                                                    <md-button
                                                            ng-csv="getExportData(item.data)"
                                                            quote-strings=" "
                                                            filename="{{tab.name}}-{{result.time}}.txt"
                                                            field-separator="\t"
                                                            csv-header="getExportHeaders(item.meta)"
                                                    >
                                                        {{'Табулированный текст без заголовков' | translate}}
                                                    </md-button>
                                                </md-menu-item>
                                            </md-menu-content>
                                        </md-menu>
                                    </div>
                                    <div style="white-space: nowrap; line-height: 40px" class="md-card pull-right mr" ng-if="item.statistics">
                                        {{'время' | translate}}: <b>{{item.statistics.elapsed | number:3}}</b>,
                                        {{'строк прочитано' | translate}}: <b>{{item.statistics.rows_read | number}}</b>,
                                        {{'прочитано' | translate}}: <b>{{item.statistics.bytes_read | filesize}}</b>

                                    </div>
                                </div>

                            </md-card>

                            <span ng-if="item.result === null">{{'нет данных' | translate}}</span>
                            <div ng-if="item.result !== null" ng-bind-html="item.result" style="overflow-x: auto; overflow-y: auto; width: 100%; min-height: 40px"></div>
                        </md-tab-body>
                    </md-tab>

                     <md-tab md-on-select="initChart(item.meta,item.data,item.query)" >
                        <md-tab-label>
                        amChart <i class="mdi mdi-show-chart"></i>
                        </md-tab-label>

                        <md-tab-body>
                            <md-card md-theme-watch>
                            <div>
                                <div id="myFirstChart" style="height:500px;width:100%;border: 1px silver dotted"></div>
                            </div>
                            </md-card>
                        </md-tab-body>
                    </md-tab>

                    <md-tab md-on-select="initPivot(item.meta,item.data,item.query)">
                        <md-tab-label>
                            Pivot <i class="mdi mdi-pages"></i>
                        </md-tab-label>

                        <md-tab-body >
                            <div id="pivotDiv" style="width:600px; height:100%"></div>

                        </md-tab-body>
                    </md-tab>

                    <md-tab md-on-select="initSankeys(item.meta,item.data,item.query)">
                        <md-tab-label>
                            Sankeys <i class="mdi mdi-pages"></i>
                        </md-tab-label>

                        <md-tab-body >
<div ng-if="echarts.sankeys">
    <echarts options="echarts.sankeys" style="width:1000px; height:700px;border: 1px solid silver" ></echarts>
</div>

                        </md-tab-body>
                    </md-tab>


                </md-tabs>



        </div>
    </md-tab-body>
</md-tab>

</div>
